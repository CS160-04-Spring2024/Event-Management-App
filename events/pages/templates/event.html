{% extends 'homebase.html' %}
{% block content %}


<style>

    .pill-bubble {
      background-color: white; /* Blue color */
      color: black; /* White text color */
      padding: 20px 30px; /* Padding inside the bubble */
      border-radius: 30px; /* Border radius to make it pill-shaped */
      /* display: inline-block; Display as inline block */
    }

    .centered {
        justify-content: center;
        align-items: center;
    }

</style>


<div class="container my-5">

<div class="centered">
    <div class="event-card">
        <div class="row justify-content-start align-items-center">
            <div class="col-md-2">
                <img class="card-img-top card-img-sm" width="190px" height="200px" src="{{ event.event_image }}"
                    style="border-radius: 20%; background-repeat: no-repeat; background-size: contain;">
            </div>
            <div class="col-md-4">
                <h1 style="font-weight: 550; font-size: 4rem;">{{event.event_name}}</h1>
            </div>
        </div>

        <!-- extra info -->
        <div class="col-md-12">
            <div class="row mt-3">
                <div class="col-md-2 d-flex">
                    <i class="bi bi-person h3 mx-3"></i>
                    <h5 class="mt-1">{{event.mode_of_operation}}</h5>
                </div>
                <div class="col-md-3 d-flex">
                    <i class="bi bi-calendar h3 mx-3"></i>
                    <h5 class="mt-1">{{event.time}}</h5>
                </div>
            </div>

        </div>
        <div class="col-md-10">
            <div class="row">
                {% for tag in event_tags %}
                <h5 class="col-auto"><span class="badge rounded-pill bg-success shadow">{{tag}}</span></h5>
                {% endfor %}
            </div>
        </div>
        
    </div>
    {% if person_admin %}
            <h4 class="" style="font-weight: 700;"><a href="{% url 'editEvent' club=club.name event_id=event.event_id %}"
                    style="text-decoration: none;">Edit Event</a></h4>
    {% endif %}

    <!-- Tags -->
</div>

    <!-- divider -->
    <hr class="my-5 " style="margin:auto; ">

    <div class="row gap-5 mt-4 justify-content-center">
        <div class="col-md-6">
            <div class=" pill-bubble shadow">
                <h2 class="" style="font-weight: 500;">Event Details</h2>
                <p class="mt-2"> {{ event.description }}</p>
            </div>
            <br>
            <!-- <hr class="my-3"> -->
            <!-- Club Details -->
            <div class="pill-bubble my-4 shadow">

                <h2 class="my-3">Brought to you by:</h2>
                <h4 class="" style="font-weight: 700;"><a href="{% url 'club' cid=event.organization_id %}" style="text-decoration: none;">{{ club.name }}</a></h4>
                <p class="mt-2">{{ club.description }}</p>
                <a href="{% url 'club' cid=event.organization_id %}" class="btn btn-outline-primary rounded-pill">Click to learn more <i class="bi bi-caret-right-fill"></i></a>

            </div>
            
            <!-- Other Events -->
            <div class="pill-bubble my-4 shadow">

                <!-- <hr class="col-md-8 my-3"> -->
                <h2 class="text-center" >Similar Events</h2>
                <div class="row  gap-3">
                    {% for similar_event in similar_events %}
                    <div class="col-md-auto">

                    
                            <div class="card position-relative h-100" style="width: 15rem; height: 16rem; border-radius: 10%;">
                                <div class="card-body">
                                    <h7 class="card-title">{{similar_event.club_name}}</h7>
                                    <h6 class="card-subtitle mb-2 text-muted">{{similar_event.event_name}}</h6>
                                    <div class="col d-flex">
                                        <i class="bi bi-person mx-2" style="font-size: small;"></i>
                                        <p class="" style="font-size: small;">{{ similar_event.mode_of_operation }}</p>
                                    </div>
                                    <div class="col d-flex">
                                        <i class="bi bi-clock mx-1" style="font-size: small;"></i>
                                        <p style="font-size: small;">{{ similar_event.time }}</p>
                                    </div>
                                    <hr>
                                    <a href="{% url 'event' event_id=similar_event.event_id %}" class="stretched-link" style="text-decoration: none;">{{ similar_event.attendees }} people registered</a>
                                </div>
                            </div>




                    </div>
                    {% endfor %}
                </div>

            </div>
        </div>


        <!-- Registration and location -->

        <div class="col-md-4 my-4" style="max-height: 30%;">

            <div class="pill-bubble shadow"> 
                <div class="my-2">
                    {% if event.attendance_limit %}
                    <span> <h4>Attendance:</h4> {{ event.attendance_limit }} person(s) registered</span>
                    <p>Slots left: {{ event.slots }}</p>
                    {% else %}
                    <span><h4>Attendance:</h4> No limit</span>
                    {% endif %}
                </div>

                {% if event.slots == 0 and registered == False %}
                    <p>No Open Spots Available</p>
                {% else %}


                {% if ended == True %}
                    <h4 class="text-dark">This event has concluded</h4>
                {% else %}
                <h4 class="mt-3 mx-auto ">Register here:</h4>
                <div class="mx-auto">
                    <p>Fee: $ {{ event.fees }}</p>

                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
                    Register!
                </button>

<!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Confirmation</h1>
                        <button type="button" class="btn-close btn-outline-primary rounded-pill my-1 " data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    
                    {% if registered == True %}
                    <div class="modal-body">
                        <p></p>
                        <p> Are you sure you would like to cancel your registration? </p>
                        <p class="text-center"> Your current balance is {{ user_funds }} </p>
                        <p class="text-center"> {{ event.fees }} will be refunded to your account  </p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <form method='post' action="{% url 'event' event_id=event.event_id %}">
                                {% csrf_token %}
                                <input type="submit" value="Unregister" name="register" class="btn btn-outline-primary rounded-pill my-1" />
                            </form>
                           
                        </div>
                        {% else %}
                        {% if user_funds < event.fees %}
                        <div class="modal-body">
                            <p class="text-center"> Your current balance is {{ user_funds }} </p>
                            <p> You do not have enough funds to make this transaction </p>
                        </div>

                            <!-- <input type="submit" value="Register" name="register" class="btn btn-outline-danger rounded-pill my-1 "
                            disabled /> -->

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>


                    {% else %}
                        <div class="modal-body">
                        <p> Are you sure you would like to pay the registration fee of ${{event.fees}}</p>
                        <p class="text-center"> Your current balance is {{ user_funds }} </p>
                            <!-- <p class="text-center"> {{ funds|add:"-event.fees" }} will be your new account balance </p> -->
                        </div>

                    <div class="modal-footer">
                        <a class="btn btn-outline-dark rounded-pill my-1" data-bs-dismiss="modal">Close</a>
                    <form method='post' action="{% url 'event' event_id=event.event_id %}">
                        {% csrf_token %}
                        <input type="submit" value="Register" name="register" class="btn btn-outline-primary rounded-pill my-1 " />
                    </form>
                    </div>
                    
                    {% endif %}
                    {% endif %}

                </div>
            </div>
        </div>
        {% endif %}
        
    {% endif %}
                <hr>
                <!-- <img src="{{location.sjsu_roadmap_image}}" class="card-img-top" alt="..."> -->
                <img src="{{location.image}}" class="card-img-top" alt="...">
                <div class="card-body">
                    <h5 class="card-title">Location</h5>
                    <p class="card-text">{{location.building_name}}</p>
    
                    <!-- <a href="#" class="btn btn-primary">Go somewhere</a> -->
                </div>

            </div>
            <!-- <div class="col-md-4"> -->
                <!-- <div class="card" style="width: 18rem; border-radius: 8%;"> -->
                <!-- </div> -->
            <!-- </div> -->

        </div>

    </div>

    {% if person_admin %}
    <hr>
        <h3 style="text-decoration: underline;"> Registered Users </h3>
        {% for peeps in registered_users %}
        <div class="pill-bubble shadow">
            <h5>Name: {{ peeps.first_name }} {{ peeps.last_name }} </h5>
            <h6>Email: {{ peeps.user_email }} </h6>
        </div>
        {% endfor %}

    {% endif %}
</div>

</div>
{% endblock %}